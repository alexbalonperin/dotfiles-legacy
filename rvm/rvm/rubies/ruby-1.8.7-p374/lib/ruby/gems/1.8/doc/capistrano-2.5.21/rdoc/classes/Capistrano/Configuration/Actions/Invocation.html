<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Capistrano::Configuration::Actions::Invocation</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Capistrano::Configuration::Actions::Invocation</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../../files/lib/capistrano/configuration/actions/invocation_rb.html">
                lib/capistrano/configuration/actions/invocation.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000522">add_default_command_options</a>&nbsp;&nbsp;
      <a href="#M000524">continue_execution</a>&nbsp;&nbsp;
      <a href="#M000525">continue_execution_for_branch</a>&nbsp;&nbsp;
      <a href="#M000519">invoke_command</a>&nbsp;&nbsp;
      <a href="#M000518">parallel</a>&nbsp;&nbsp;
      <a href="#M000520">run</a>&nbsp;&nbsp;
      <a href="#M000521">sudo</a>&nbsp;&nbsp;
      <a href="#M000523">sudo_prompt</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Module <a href="Invocation/ClassMethods.html" class="link">Capistrano::Configuration::Actions::Invocation::ClassMethods</a><br />

    </div>




      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000522" class="method-detail">
        <a name="M000522"></a>

        <div class="method-heading">
          <a href="Invocation.src/M000522.html" target="Code" class="method-signature"
            onclick="popupCode('Invocation.src/M000522.html');return false;">
          <span class="method-name">add_default_command_options</span><span class="method-args">(options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Merges the various default command options into the options hash and
returns the result. The default command options that are understand are:
</p>
<ul>
<li>:default_environment: If the :env key already exists, the :env key is
merged into default_environment and then added back into options.

</li>
<li>:default_shell: if the :shell key already exists, it will be used.
Otherwise, if the :default_shell key exists in the configuration, it will
be used. Otherwise, no :shell key is added.

</li>
</ul>
        </div>
      </div>

      <div id="method-M000524" class="method-detail">
        <a name="M000524"></a>

        <div class="method-heading">
          <a href="Invocation.src/M000524.html" target="Code" class="method-signature"
            onclick="popupCode('Invocation.src/M000524.html');return false;">
          <span class="method-name">continue_execution</span><span class="method-args">(tree)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000525" class="method-detail">
        <a name="M000525"></a>

        <div class="method-heading">
          <a href="Invocation.src/M000525.html" target="Code" class="method-signature"
            onclick="popupCode('Invocation.src/M000525.html');return false;">
          <span class="method-name">continue_execution_for_branch</span><span class="method-args">(branch)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000519" class="method-detail">
        <a name="M000519"></a>

        <div class="method-heading">
          <a href="Invocation.src/M000519.html" target="Code" class="method-signature"
            onclick="popupCode('Invocation.src/M000519.html');return false;">
          <span class="method-name">invoke_command</span><span class="method-args">(cmd, options={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Invokes the given command. If a <tt>via</tt> key is given, it will be used
to determine what method to use to invoke the command. It defaults to :<a
href="Invocation.html#M000520">run</a>, but may be :<a
href="Invocation.html#M000521">sudo</a>, or any other method that conforms
to the same interface as <a href="Invocation.html#M000520">run</a> and <a
href="Invocation.html#M000521">sudo</a>.
</p>
        </div>
      </div>

      <div id="method-M000518" class="method-detail">
        <a name="M000518"></a>

        <div class="method-heading">
          <a href="Invocation.src/M000518.html" target="Code" class="method-signature"
            onclick="popupCode('Invocation.src/M000518.html');return false;">
          <span class="method-name">parallel</span><span class="method-args">(options={}) {|t| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Executes different commands in <a
href="Invocation.html#M000518">parallel</a>. This is useful for commands
that need to be different on different hosts, but which could be otherwise
<a href="Invocation.html#M000520">run</a> in <a
href="Invocation.html#M000518">parallel</a>.
</p>
<p>
The <tt>options</tt> parameter is currently unused.
</p>
<p>
Example:
</p>
<pre>
  task :restart_everything do
    parallel do |session|
      session.when &quot;in?(:app)&quot;, &quot;/path/to/restart/mongrel&quot;
      session.when &quot;in?(:web)&quot;, &quot;/path/to/restart/apache&quot;
      session.when &quot;in?(:db)&quot;, &quot;/path/to/restart/mysql&quot;
    end
  end
</pre>
<p>
Each command may have its own callback block, for capturing and responding
to output, with semantics identical to <a
href="Invocation.html#M000520">run</a>:
</p>
<pre>
  session.when &quot;in?(:app)&quot;, &quot;/path/to/restart/mongrel&quot; do |ch, stream, data|
    # ch is the SSH channel for this command, used to send data
    #    back to the command (e.g. ch.send_data(&quot;password\n&quot;))
    # stream is either :out or :err, for which stream the data arrived on
    # data is a string containing data sent from the remote command
  end
</pre>
<p>
Also, you can specify a fallback command, to use when none of the
conditions match a server:
</p>
<pre>
  session.else &quot;/execute/something/else&quot;
</pre>
<p>
The string specified as the first argument to <tt>when</tt> may be any
valid Ruby code. It has access to the following variables and methods:
</p>
<ul>
<li>+in?(role)+ returns true if the server participates in the given role

</li>
<li><tt>server</tt> is the <a
href="../../ServerDefinition.html">ServerDefinition</a> object for the
server. This can be used to get the host-name, etc.

</li>
<li><tt>configuration</tt> is the current <a
href="../../Configuration.html">Capistrano::Configuration</a> object, which
you can use to get the value of variables, etc.

</li>
</ul>
<p>
For example:
</p>
<pre>
  session.when &quot;server.host =~ /app/&quot;, &quot;/some/command&quot;
  session.when &quot;server.host == configuration[:some_var]&quot;, &quot;/another/command&quot;
  session.when &quot;in?(:web) || in?(:app)&quot;, &quot;/more/commands&quot;
</pre>
<p>
See <a href="Invocation.html#M000520">run</a> for a description of the
valid <tt>options</tt>.
</p>
        </div>
      </div>

      <div id="method-M000520" class="method-detail">
        <a name="M000520"></a>

        <div class="method-heading">
          <a href="Invocation.src/M000520.html" target="Code" class="method-signature"
            onclick="popupCode('Invocation.src/M000520.html');return false;">
          <span class="method-name">run</span><span class="method-args">(cmd, options={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Execute the given command on all servers that are the target of the current
task. If a block is given, it is invoked for all output generated by the
command, and should accept three parameters: the <a
href="../../SSH.html">SSH</a> channel (which may be used to send data back
to the remote process), the stream identifier (<tt>:err</tt> for stderr,
and <tt>:out</tt> for stdout), and the data that was received.
</p>
<p>
The <tt>options</tt> hash may include any of the following keys:
</p>
<ul>
<li>:hosts - this is either a string (for a single target host) or an array of
strings, indicating which hosts the command should <a
href="Invocation.html#M000520">run</a> on. By default, the hosts are
determined from the task definition.

</li>
<li>:roles - this is either a string or symbol (for a single target role) or an
array of strings or symbols, indicating which roles the command should <a
href="Invocation.html#M000520">run</a> on. If :hosts is specified, :roles
will be ignored.

</li>
<li>:only - specifies a condition limiting which hosts will be selected to <a
href="Invocation.html#M000520">run</a> the command. This should refer to
values set in the role definition. For example, if a role is defined with
:primary =&gt; true, then you could select only hosts with :primary true by
setting :only =&gt; { :primary =&gt; true }.

</li>
<li>:except - specifies a condition limiting which hosts will be selected to <a
href="Invocation.html#M000520">run</a> the command. This is the inverse of
:only (hosts that do <em>not</em> match the condition will be selected).

</li>
<li>:once - if true, only the first matching server will be selected. The
default is false (all matching servers will be selected).

</li>
<li>:max_hosts - specifies the maximum number of hosts that should be selected
at a time. If this value is less than the number of hosts that are selected
to <a href="Invocation.html#M000520">run</a>, then the hosts will be <a
href="Invocation.html#M000520">run</a> in groups of max_hosts. The default
is nil, which indicates that there is no maximum host limit. Please note
this does not limit the number of <a href="../../SSH.html">SSH</a> channels
that can be open, only the number of hosts upon which this will be called.

</li>
<li>:shell - says which shell should be used to invoke commands. This defaults
to &quot;sh&quot;. Setting this to false causes <a
href="../../../Capistrano.html">Capistrano</a> to invoke the commands
directly, without wrapping them in a shell invocation.

</li>
<li>:data - if not nil (the default), this should be a string that will be
passed to the command&#8216;s stdin stream.

</li>
<li>:pty - if true, a pseudo-tty will be allocated for each command. The
default is false. Note that there are benefits and drawbacks both ways.
Empirically, it appears that if a pty is allocated, the <a
href="../../SSH.html">SSH</a> server daemon will <em>not</em> read user
shell start-up scripts (e.g. bashrc, etc.). However, if a pty is
<em>not</em> allocated, some commands will refuse to <a
href="Invocation.html#M000520">run</a> in interactive mode and will not
prompt for (e.g.) passwords.

</li>
<li>:env - a hash of environment variable mappings that should be made
available to the command. The keys should be environment variable names,
and the values should be their corresponding values. The default is empty,
but may be modified by changing the <tt>default_environment</tt> <a
href="../../../Capistrano.html">Capistrano</a> variable.

</li>
</ul>
<p>
Note that if you set these keys in the <tt>default_run_options</tt> <a
href="../../../Capistrano.html">Capistrano</a> variable, they will apply
for all invocations of <a href="Invocation.html#M000520">run</a>, <a
href="Invocation.html#M000519">invoke_command</a>, and <a
href="Invocation.html#M000518">parallel</a>.
</p>
        </div>
      </div>

      <div id="method-M000521" class="method-detail">
        <a name="M000521"></a>

        <div class="method-heading">
          <a href="Invocation.src/M000521.html" target="Code" class="method-signature"
            onclick="popupCode('Invocation.src/M000521.html');return false;">
          <span class="method-name">sudo</span><span class="method-args">(*parameters, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the command string used by capistrano to invoke a comamnd via <a
href="Invocation.html#M000521">sudo</a>.
</p>
<pre>
  run &quot;#{sudo :as =&gt; 'bob'} mkdir /path/to/dir&quot;
</pre>
<p>
It can also be invoked like <a href="Invocation.html#M000520">run</a>, but
executing the command via <a href="Invocation.html#M000521">sudo</a>. This
assumes that the <a href="Invocation.html#M000521">sudo</a> password (if
required) is the same as the password for logging in to the server.
</p>
<pre>
  sudo &quot;mkdir /path/to/dir&quot;
</pre>
<p>
Also, this method understands a <tt>:<a
href="Invocation.html#M000521">sudo</a></tt> configuration variable, which
(if specified) will be used as the full path to the <a
href="Invocation.html#M000521">sudo</a> executable on the remote machine:
</p>
<pre>
  set :sudo, &quot;/opt/local/bin/sudo&quot;
</pre>
<p>
If you know what you&#8216;re doing, you can also set <tt>:<a
href="Invocation.html#M000523">sudo_prompt</a></tt>, which tells capistrano
which prompt <a href="Invocation.html#M000521">sudo</a> should use when
asking for a password. (This is so that capistrano knows what prompt to
look for in the output.) If you set :<a
href="Invocation.html#M000523">sudo_prompt</a> to an empty string, <a
href="../../../Capistrano.html">Capistrano</a> will not send a preferred
prompt.
</p>
        </div>
      </div>

      <div id="method-M000523" class="method-detail">
        <a name="M000523"></a>

        <div class="method-heading">
          <a href="Invocation.src/M000523.html" target="Code" class="method-signature"
            onclick="popupCode('Invocation.src/M000523.html');return false;">
          <span class="method-name">sudo_prompt</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the prompt text to use with <a
href="Invocation.html#M000521">sudo</a>
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>