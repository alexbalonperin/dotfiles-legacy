<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Gem::Package::TarInput</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Gem::Package::TarInput</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/rubygems/package/tar_input_rb.html">
                lib/rubygems/package/tar_input.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000112">close</a>&nbsp;&nbsp;
      <a href="#M000113">each</a>&nbsp;&nbsp;
      <a href="#M000114">extract_entry</a>&nbsp;&nbsp;
      <a href="#M000115">load_gemspec</a>&nbsp;&nbsp;
      <a href="#M000111">new</a>&nbsp;&nbsp;
      <a href="#M000110">open</a>&nbsp;&nbsp;
      <a href="#M000116">zipped_stream</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="FSyncDir.html">Gem::Package::FSyncDir</a></span>
        <span class="include-name">Enumerable</span>
      </div>
    </div>

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">metadata</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="TarInput.src/M000111.html" target="Code" class="method-signature"
            onclick="popupCode('TarInput.src/M000111.html');return false;">
          <span class="method-name">new</span><span class="method-args">(io, security_policy = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="TarInput.src/M000110.html" target="Code" class="method-signature"
            onclick="popupCode('TarInput.src/M000110.html');return false;">
          <span class="method-name">open</span><span class="method-args">(io, security_policy = nil) {|is| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000112" class="method-detail">
        <a name="M000112"></a>

        <div class="method-heading">
          <a href="TarInput.src/M000112.html" target="Code" class="method-signature"
            onclick="popupCode('TarInput.src/M000112.html');return false;">
          <span class="method-name">close</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000113" class="method-detail">
        <a name="M000113"></a>

        <div class="method-heading">
          <a href="TarInput.src/M000113.html" target="Code" class="method-signature"
            onclick="popupCode('TarInput.src/M000113.html');return false;">
          <span class="method-name">each</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000114" class="method-detail">
        <a name="M000114"></a>

        <div class="method-heading">
          <a href="TarInput.src/M000114.html" target="Code" class="method-signature"
            onclick="popupCode('TarInput.src/M000114.html');return false;">
          <span class="method-name">extract_entry</span><span class="method-args">(destdir, entry, expected_md5sum = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000115" class="method-detail">
        <a name="M000115"></a>

        <div class="method-heading">
          <a href="TarInput.src/M000115.html" target="Code" class="method-signature"
            onclick="popupCode('TarInput.src/M000115.html');return false;">
          <span class="method-name">load_gemspec</span><span class="method-args">(io)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Attempt to YAML-load a gemspec from the given <em>io</em> parameter. Return
nil if it fails.
</p>
        </div>
      </div>

      <div id="method-M000116" class="method-detail">
        <a name="M000116"></a>

        <div class="method-heading">
          <a href="TarInput.src/M000116.html" target="Code" class="method-signature"
            onclick="popupCode('TarInput.src/M000116.html');return false;">
          <span class="method-name">zipped_stream</span><span class="method-args">(entry)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return an IO stream for the zipped entry.
</p>
<p>
NOTE: Originally this method used two approaches, Return a GZipReader
directly, or read the GZipReader into a string and return a StringIO on the
string. The string IO approach was used for versions of ZLib before 1.2.1
to avoid buffer errors on windows machines. Then we found that errors
happened with 1.2.1 as well, so we changed the condition. Then we
discovered errors occurred with versions as late as 1.2.3. At this point
(after some benchmarking to show we weren&#8216;t seriously crippling the
unpacking speed) we threw our hands in the air and declared that this
method would use the String IO approach on all platforms at all times. And
that&#8216;s the way it is.
</p>
<p>
Revisited. Here&#8216;s the beginning of the long story. <a
href="http://osdir.com/ml/lang.ruby.gems.devel/2007-06/msg00045.html">osdir.com/ml/lang.ruby.gems.devel/2007-06/msg00045.html</a>
</p>
<p>
StringIO wraping has never worked as a workaround by definition. Skipping
initial 10 bytes and passing -MAX_WBITS to Zlib::Inflate luckily works as
gzip reader, but it only works if the GZip header is 10 bytes long (see
below) and it does not check inflated stream consistency (CRC value in the
Gzip trailer.)
</p>
<pre>
  RubyGems generated Gzip Header: 10 bytes
    magic(2) + method(1) + flag(1) + mtime(4) + exflag(1) + os(1) +
    orig_name(0) + comment(0)
</pre>
<p>
Ideally, it must return a GZipReader without meaningless buffering. We have
lots of CRuby committers around so let&#8216;s fix windows build when we
received an error.
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>